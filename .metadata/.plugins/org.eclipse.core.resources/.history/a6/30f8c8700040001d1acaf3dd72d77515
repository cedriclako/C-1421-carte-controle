/* USER CODE BEGIN Header */
/**
  ******************************************************************************
  * @file           : DebugManager.c
  * @brief          : Print debug message to serial Port
  ******************************************************************************
  * @attention
  *
  * NOTICE:  All information contained herein is, and remains
  * the property of SBI.  The intellectual and technical concepts contained
  * herein are proprietary to SBI may be covered by Canadian, US and Foreign Patents,
  * patents in process, and are protected by trade secret or copyright law.
  * Dissemination of this information or reproduction of this material
  * is strictly forbidden unless prior written permission is obtained
  * from SBI.
  *
  ******************************************************************************
  */
/* USER CODE END Header */

/* Includes ------------------------------------------------------------------*/

/* Private includes ----------------------------------------------------------*/
#include "cmsis_os.h"
#include "stm32f1xx_hal.h"
#include "TemperatureManager.h"
#include "MotorManager.h"
#include <stdbool.h>
#include <stdlib.h>
#include <math.h>
#include "main.h" //@@@@for the LED toggle to be removed
#include "algo.h"
#include <stdio.h>
#include "DebugPort.h"


/* Private typedef -----------------------------------------------------------*/
/* Private define ------------------------------------------------------------*/
/* Private macro -------------------------------------------------------------*/
/* Private variables ---------------------------------------------------------*/
/* Private function ---------------------------------------------------------*/

/* USER CODE BEGIN Header_Debugmanager */
/**
* @brief Function implementing the DebugManagerT thread.
* @param argument: Not used
* @retval None
*/
/* USER CODE END Header_Steppermanager */
void DebugManager(void const * argument)
{
  /* USER CODE BEGIN DebugManager */
  /* Infinite loop */

	State TempAlgoState;
	printf("#");

	for(;;)
	{
		printf("#");
		osDelay(5000);
		HAL_RTC_GetTime(&hrtc,&sTime,0);
		printf("#");
		printf("%02i:%02i:%02i ",sTime.Hours,sTime.Minutes,sTime.Seconds);
		printf("Tavant:%iF TArriere:%iF Plenum:%iF ",Algo_getBaffleTemp()/10,Algo_getRearTemp()/10,Algo_getPlenumTemp()/10);
		printf("State:");

		TempAlgoState = Algo_getState();
		switch (TempAlgoState) {
			case ZEROING_STEPPER:
				printf("ZEROING_STEP");
				break;
			case WAITING:
				printf("WAITING");
				break;
			case TEMPERATURE_RISE:
				printf("TEMP_RISE");
				break;
			case COMBUSTION_LOW:
				printf("COMB_LOW");
				break;
			case COMBUSTION_LOW2:
				printf("COMB_LOW2");
				break;
			case COMBUSTION_HIGH:
				printf("COMB_HIGH");
				break;
			case RELOAD_IGNITION:
				printf("RELOAD_IGNI");
				break;
			case FLAME_LOSS:
				printf("FLAME_LOSS");
				break;
			case COAL_HIGH:
				printf("COAL_HIGH");
				break;
			case COAL_LOW:
				printf("COAL_LOW");
				break;
			case OVERTEMP:
				printf("OVERTEMP");
				break;
			case SAFETY:
				printf("SAFETY");
				break;
			case PRODUCTION_TEST:
				printf("PRODTEST");
				break;
			default:
				printf("UNKNOWN");
				break;
		}
		printf(" tStat:");
		if (Algo_getThermostatRequest())
		{
			printf("ON ");
		}
		else
		{
			printf("OFF ");
		}
		printf("dTav:%i",(int)Algo_getBaffleTempSlope());
		printf(" FanSpeed:%i ",Mot_getFanSpeed());
		printf("Grille:%i ",	Algo_getGrill()*9/10);
		printf("PIDPos:%i ",PIDTrapPosition*9/10);
		printf("PrimSec:%i",Algo_getPrimary()*9/10);
		printf("*\n\r");
  }
  /* USER CODE END DebugManager */
}
